/**
 * app-bootstrap-dictionary-web
 * @version v0.0.1 - 2015-02-06
 * @link http://git-components.teamnet.ro/summary/angular-component%2Fapp-bootstrap-dictionary-web.git
 * @author mihaela.petre mihaela.petre@teamnet.ro
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";function isArrayWithData(a){return void 0!=a&&null!=a&&"[object Array]"===Object.prototype.toString.call(a)&&void 0!=a.length&&a.length>0}function widgetEffects(a){$(a).draggable({revert:!0,zIndex:2e3,cursor:"crosshair",handle:".box-name",opacity:.8}).droppable({tolerance:"pointer",drop:function(a,b){{var c=b.draggable,d=$(this);c.position(),d.position()}c.swap(d)}}).on("click",".collapse-link",function(a){a.preventDefault();var b=$(this).closest("div.box"),c=$(this).find("i"),d=b.find("div.box-content");d.slideToggle("fast"),c.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),setTimeout(function(){b.resize(),b.find("[id^=map-]").resize()},50)}).on("click",".close-link",function(a){a.preventDefault();var b=$(this).closest("div.box");b.remove()}).on("click",".expand-link",function(a){var b=$("body");a.preventDefault();var c=$(this).closest("div.box"),d=$(this).find("i");d.toggleClass("fa-expand").toggleClass("fa-compress"),c.toggleClass("expanded"),b.toggleClass("body-expanded");var e=0;b.hasClass("body-expanded")&&(e=100),setTimeout(function(){c.toggleClass("expanded-padding")},e),setTimeout(function(){c.resize(),c.find("[id^=map-]").resize()},e+50)})}angular.module("angular-component.app-bootstrap-dictionary-web",["ngRoute","app-bootstrap-dictionary-webTemplate.html","bootstrapControllers","bootstrapServices","bootstrapDirectives"]).config(["$routeProvider",function(a){a.when("/dictionaries",{templateUrl:"template/dictionaries.html",controller:"DictionaryController"}).when("/grid-dictionaries",{templateUrl:"template/gridDictionaries.html",controller:"DictionaryController"})}]);var bootstrapControllers=angular.module("bootstrapControllers",[]),bootstrapServices=angular.module("bootstrapServices",[]),bootstrapDirectives=angular.module("bootstrapDirectives",["angular-component.app-grid"]);angular.module("app-bootstrap-dictionary-webTemplate.html",[]).run(["$templateCache",function(a){a.put("template/app-bootstrap-dictionary-web.html","<div>Hey</div>"),a.put("template/dictionaries.html","<div><h1>Dictionaries:</h1><br>{{dictionariesHttp}}</div>"),a.put("template/gridDictionaries.html","<div>URL: {{url}}<app-grid url=url></app-grid></div>")}]),bootstrapControllers.controller("DictionaryController",["$scope","dataDictionariesHttp",function(a,b){a.url="/dictionary/rest/dictionaries",a.status,a.dictionariesHttp={}}]),angular.module("angular-component.app-grid",["app-grid-html-templates","ngResource","ui.grid","ui.grid.paging","pascalprecht.translate"]).directive("appGrid",["$resource","$compile","$templateCache",function(a,b,c){return{restrict:"E",scope:{dataUrl:"=url",title:"=",columnDefs:"=",filter:"=",sort:"="},controller:"appGridController",link:function(a,b){widgetEffects($(b))},compile:function(){return{pre:function(a,d){0===d.children().length&&d.append(b(c.get("template/app-grid.html"))(a))}}}}}]).controller("appGridController",["$scope","$resource","$templateCache","GridTranslateService",function(a,b,c,d){function e(b){var c=[];if(isArrayWithData(a.columnDefs))c=a.columnDefs;else if(isArrayWithData(b.metadata))c=b.metadata;else if(isArrayWithData(b.content))for(var d in b.content[0]){var e=d.charAt(0).toUpperCase()+d.slice(1).toLowerCase();c.push({field:d,displayName:e})}return c}a.gridStyle={},a.filters=isArrayWithData(a.filter)?a.filter:[],a.paginationOptions={pageNumber:0,pageSize:25},a.uiGridOptions={enableSorting:!0,useExternalSorting:!0,enableFiltering:!0,useExternalFiltering:!0,enablePaging:!0,useExternalPaging:!0},a.getPage=function(){var c={page:a.paginationOptions.pageNumber,size:a.paginationOptions.pageSize,filters:a.filters,sort:[]},f=b(a.dataUrl).get(c,function(){a.uiGridOptions.pagingPageSize=f.pageable.pageSize,a.uiGridOptions.pagingPageSizes=[f.pageable.pageSize],isArrayWithData(a.uiGridOptions.columnDefs)||(a.uiGridOptions.columnDefs=d.translate(e(f),a.$root.locale)),a.uiGridOptions.data=f.content})},a.getPage(),a.uiGridOptions.onRegisterApi=function(b){a.gridApi=b,a.gridApi.core.on.filterChanged(a,function(){for(var b=a.gridApi.grid.columns,c=[],d=0;d<b.length;d++){var e=b[d],f=isArrayWithData(e.filters)&&void 0!=e.filters[0].term&&null!=e.filters[0].term&&""!==e.filters[0].term.trim();if(f){var g={};g[e.field]=e.filters[0].term.trim(),console.log("filter: "+g),c.push(g)}}var h=!1;a.filters.length!=c.length?h=!0:angular.forEach(c,function(b){-1===a.filters.indexOf(b)&&(h=!0)}),h&&(a.filters=c,a.getPage())}),a.gridApi.core.on.sortChanged(a,function(){console.log("sort"),a.getPage()}),a.gridApi.paging.on.pagingChanged(a,function(b,c){console.log("page changed: "+b),a.paginationOptions.pageNumber=b-1,a.paginationOptions.pageSize=c,a.getPage()})},a.excelExport=function(){}}]).factory("GridTranslateService",["$cookieStore","$translate",function(a,b){return{translate:function(a,c){if(!isArrayWithData(a))return[];for(var d=0;d<a.length;d++)a[d].displayName.indexOf("ROW_NUM")>0?(a[d].displayName=b.instant("grid.rownum.label"),a[d].sortable=!1):a[d].displayName=b.instant(a[d].displayName),"java.util.Date"==a[d].fieldType&&(a[d].cellFilter="date:'"+c.date+"'");return a}}}]).directive("toolbarIcon",["$translate",function(a){return{restrict:"EA",scope:{"class":"@",titleKey:"@"},link:function(b,c){$(c).html("<a class='"+b["class"]+"'  title='"+a.instant(b.titleKey)+"'><i class='"+b["class"]+"'></i></a>")}}}]),angular.module("app-grid-html-templates",[]).run(["$templateCache",function(a){a.put("template/app-grid.html",'<div class="box ui-draggable ui-droppable"><div class=box-header><div class=box-name><i class="fa fa-list-alt"></i> <span>{{title}}</span></div><div class=box-icons><toolbar-icon class=xls ng-click=excelExport() title-key=excel.download></toolbar-icon><a class=collapse-link><i class="fa fa-chevron-up"></i></a> <a class=expand-link><i class="fa fa-expand"></i></a> <a class=close-link><i class="fa fa-times"></i></a></div><div class=no-move></div></div><div ui-grid=uiGridOptions ui-grid-paging class=gridStyle ng-style=gridStyle></div></div>')}]),bootstrapServices.factory("dataDictionariesHttp",["$http",function(a){var b="/dictionary/rest/dictionaries",c={};return c.getDictionaries=function(){return a.get(b)},c.getDictionary=function(c){return a.get(b+"/"+c)},c.insertDictionary=function(c){return a.post(b,c)},c.updateDictionary=function(c){return a.post(b,c)},c.deleteDictionary=function(c){return a["delete"](b+"/"+c)},c}]);